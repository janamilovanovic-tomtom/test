name: Download from SharePoint

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  download:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Use Access Token from Secrets
        id: use_token
        run: |
          echo "Using access token from GitHub Secrets."
          echo "${{ secrets.SP_ACCESS_TOKEN }}" > access_token.txt
          echo "Access token retrieved successfully."

      - name: Download file from SharePoint
        run: |

          DOWNLOAD_URL="https://graph.microsoft.com/v1.0/sites/055adf94-42e1-4941-8cd8-eb7ab60ca37d/drive/items/01HTWZYNWLWIF75TXITRAKXS72RFJ4NTTO/content"
          echo "Download URL: $DOWNLOAD_URL"

          FILE_NAME="README.md"
          echo "Downloading file: $FILE_NAME"
          response=$(curl -X GET \
            -H "Authorization: Bearer $(cat access_token.txt)" \
            -H "Accept: application/octet-stream")

          if [ "$response" -eq 200 ]; then
            echo "File downloaded successfully and saved as ./$FILE_NAME."
          else
            echo "Failed to download file. HTTP status code: $response"
            exit 1
          fi